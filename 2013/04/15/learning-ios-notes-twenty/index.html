<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS笔记(20) | 萧宸宇</title>
  <meta name="author" content="萧宸宇">
  
  <meta name="description" content="fuck">
  
  
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

  <meta property="og:title" content="iOS笔记(20)"/>
  <meta property="og:site_name" content="萧宸宇"/>

  <link rel="alternate" href="/atom.xml" title="萧宸宇" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29764460-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">萧宸宇</a></h1>
  <h2><a href="/">如果不能成为拯救世界的神，那就堕落到征服世界的魔吧。</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/about-me">关于我</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">

<article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-15T06:02:11.000Z"><a href="/2013/04/15/learning-ios-notes-twenty/">4月 15 2013</a></time>
      
      
  
    <h1 class="title">iOS笔记(20)</h1>
  

    </header>
    <div class="entry">
      
        <h1>UITableView简单解析</h1>
<h2>序</h2>
<p>UITableView是在iOS开发中，展示大量内容的首选。我个人认为的原有有一下几点：</p>
<ol>
<li>UITableView的展现形式是为移动设备专门设计过的。有较好的人机交互体验。</li>
<li>从技术角度来说UITableView具有重用和延迟加载等特性。如果使用恰当。可以获得一个App流畅的用户体验。</li>
</ol>
<p>这样，使得UITableView在iOS App中随处可见。</p>
<p>原生应用</p>
<p><img src="http://ww4.sinaimg.cn/large/a74ecc4cjw1e3q5jk1wrtj.jpg" alt=""></p>
<p>一些有名的App.图片信息较老</p>
<p><img src="http://ww4.sinaimg.cn/large/a74eed94jw1e3q5kl91luj.jpg" alt=""></p>
<p>包括游戏</p>
<p><img src="http://ww1.sinaimg.cn/large/a74e55b4jw1e3q5lb59vwj.jpg" alt=""></p>
<p>这些都说明UITableView在一个App中其实是一个很常用的控件。我应该好好的学习它。</p>
<a name="more"></a>


<h2>关于数据的思考</h2>
<h3>没有UITableView的时候我是这样想的</h3>
<p>首先思考为什么会有UITableView这样的控件。我们做一个App的时候，就会有大量的数据需要显示。比如weibo的每一个状态。比如一个新闻App的很多条新闻。这些数据都会有一个特点就是他们的组织形式一样，只是内容变化。有时候我们可能会根据一些条件进行分组。使得看来了是分组的。例如 联系人里面会按照首字母来进行分组一样。我们还可能会点击数据以便查看更详细的内容。</p>
<p>通过上面的简单描述，如果来自己实现一个类似UITableView的结构。需要得到最核心的：</p>
<ol>
<li>需要得到一共多少条数据</li>
<li>数据的具体内容是什么</li>
</ol>
<p>如果我们数据需要更加仔细的描述展示：</p>
<ol>
<li>全部的数据一共有多少组</li>
<li>每一组有多少个数据</li>
<li>每一条数据的具体内容是什么</li>
</ol>
<h3>UITableView是怎么做的</h3>
<p>在UITableView中。最重要的就是data source中的两个方法。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="pp">- <span class="params">(<span class="variable">NSInteger</span>)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView numberOfRowsInSection:<span class="params">(<span class="variable">NSInteger</span>)</span>section;

- <span class="params">(<span class="variable">UITableViewCell</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView cellForRowAtIndexPath:<span class="params">(<span class="variable">NSIndexPath</span> *)</span>indexPath;
</pre></td></tr></table></figure>

<p>什么是data source。字面意思就是很明白，数据的来源。一般情况下我们会设置拥有UITableView的这个UIViewController为他的data source。因为根据MVC来说。UITableView是View，UIViewController是Controller。View需要的数据，应该是Controller去跟Model协调然后获得，以后由Controller去给View来进行显示。View永远的不去直接跟Model联系。这样当UITableView初始化的时候。他就会去问他的data source。我需要显示多少行数据啊。每一行的数据都是什么内容啊。这时候UIViewController应该已经从Model拿到了数据。然后通过- (NSInteger)tableView:(UITableView <em>)tableView numberOfRowsInSection:(NSInteger)section;告诉UITableview，恩你的这一组要显示n条数据。又用- (UITableViewCell </em>)tableView:(UITableView <em>)tableView cellForRowAtIndexPath:(NSIndexPath </em>)indexPath函数告诉UITableView说，第几组第几条数据的具体内容是什么。</p>
<p>UITableView还有一个比较犀利的地方就是如果你的数据有10000条。它肯定不是把10000条都加载进来。而是只加载需要显示的条目数据。这样设计，使得UITableView的流畅程度大大提高。值得注意的是，如果Cell里面的数据是从网络 or Core Data等其他地方读取的。我们应该把读取动作写成异步的。不阻塞主线程。取到数据以后在回答主线程去刷新UI。</p>
<p>UITableView从创建到显示的调用顺序如下图</p>
<p><img src="http://ww4.sinaimg.cn/large/a74ecc4cjw1e3sfatxy0gj.jpg" alt=""></p>
<ul>
<li>(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView这个函数是最先调用，但是它默认返回1.所以并不是必须的。如果你的UITableView分了好几组，这个就是用来返回组的数量的。</li>
</ul>
<p>这样完成了设置UITableView的data source设置。在完成</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="pp">- <span class="params">(<span class="variable">NSInteger</span>)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView numberOfRowsInSection:<span class="params">(<span class="variable">NSInteger</span>)</span>section;

- <span class="params">(<span class="variable">UITableViewCell</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView cellForRowAtIndexPath:<span class="params">(<span class="variable">NSIndexPath</span> *)</span>indexPath;
</pre></td></tr></table></figure>

<p>这两个函数。我们就可以得到一个能显示的UITableView了。</p>
<p>现在是是仅仅解释了UITableView的数据是怎么来的，然后怎么对应到UITableView上面。</p>
<h2>UITableViewCell</h2>
<p>UITableViewCell具体的每一条数据展示的具体View。首先在UITableView里面有这样一个特点，每一个Cell的大概样子都长的差不多，只是里面具体的内容稍有变化。这样在UI里面我们应该是重用相同的部分，改变不同的部分。这样才能提高效率。因为在UiTableView这个视图里面，用户习惯性快速的滚动，视图和数据内容都会快速的变化，如果效率问题处理不好，很容易有卡顿的现象。造成用户体验的降低。</p>
<p>如果使用默认的UITableViewCell风格，有以下四种</p>
<p>UITableViewCellStyleDefault</p>
<p><img src="http://ww2.sinaimg.cn/large/a74eed94jw1e3sha1cl2oj.jpg" alt=""></p>
<p>UITableViewCellStyleSubtile</p>
<p><img src="http://ww4.sinaimg.cn/large/a74e55b4jw1e3shcdevpbj.jpg" alt=""></p>
<p>UITableViewCellStyleValue1</p>
<p><img src="http://ww1.sinaimg.cn/large/bfadf3bejw1e3shcssq55j.jpg" alt=""></p>
<p>UITableViewCellStyleValue2</p>
<p><img src="http://ww4.sinaimg.cn/large/a74ecc4cjw1e3shdbgbrgj.jpg" alt=""></p>
<p>当然如果是需要自定义Cell也是很简单。 用xib拖一个，完全可以GUI的方式来创建，很是方便。</p>
<p>(Google一个栗子吧，写不动了)</p>
<p>插一句，Cell的重用是需要下面这样的实现方法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *Cell = @<span class="string">"MyCell"</span>;
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:Cell];
    <span class="keyword">if</span> (!cell) {
        cell = <span class="string">[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:Cell];
    }
    return cell;
}
</pre></td></tr></table></figure>


<p>重要的是UITableView的dequeueReusableCellWithIdentifier方法。</p>
<p>dequeueReusableCellWithIdentifier去一个队列里面需找有没有相同ID的的Cell。如果有就提出来重用。可以重用的部分。如果没有就跳进if里面去创建。所以我们在if里面创建的时候，不会改变的内容都可以在里面创建，这样就只用创建一次。需要改变的内容我们就放到if后面去写。 这样我们就能完成高效的UITableView。当然，理论上来说，你可以不用这样的机制，而去直接每次创建一个Cell。不过这是非常浪费资源的一个做法，直接不提倡。</p>
<h2>UITableView Delegate</h2>
<p>当然，在写UITableView肯定想控制的更多。才能完成设计师们辛辛苦苦画出来的稿。这样我们可以去看看Data source里面剩下的函数和Delegate。</p>
<p>当然就说一点</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="comment">//选中Cell响应事件</span>
- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath
{
    <span class="comment">//选中后的反显颜色即刻消失</span>
    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];
}
</pre></td></tr></table></figure>

<p>这个是选中Cell时候会的出发点。如果要点击以后做什么事情 就在这里做了。 </p>
<p><a href="http://www.devdiv.com/home.php?mod=space&amp;uid=39974&amp;do=blog&amp;id=2573">找了篇目测还ok的中文blog可以先看看了解</a></p>
<h2>数据刷新</h2>
<p>如果我们的modle更新了。相应的要体现到UITableView上面。简单的我们可以reload整个TableView。这样做很方便，而且数据上没有问题。唯一的问题就是，reload整个TableView的效率太低了。而且，往往我们只是少数的Cell内容变化。所以没有必要去reload整个TableView。而是那条数据变化去刷新对应的Cell就好了。这样做效率提高很多。</p>
<p>具体涉及到的几个函数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="pp">- <span class="params">(void)</span>beginUpdates;
- <span class="params">(void)</span>endUpdates;
 
- <span class="params">(void)</span>insertSections:<span class="params">(<span class="variable">NSIndexSet</span> *)</span>sections withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;
- <span class="params">(void)</span>deleteSections:<span class="params">(<span class="variable">NSIndexSet</span> *)</span>sections withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;
- <span class="params">(void)</span>reloadSections:<span class="params">(<span class="variable">NSIndexSet</span> *)</span>sections withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;
 
- <span class="params">(void)</span>insertRowsAtIndexPaths:<span class="params">(<span class="variable">NSArray</span> *)</span>indexPaths withRowAnimation: <span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;
- <span class="params">(void)</span>deleteRowsAtIndexPaths:<span class="params">(<span class="variable">NSArray</span> *)</span>indexPaths withRowAnimation: <span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;
- <span class="params">(void)</span>reloadRowsAtIndexPaths:<span class="params">(<span class="variable">NSArray</span> *)</span>indexPaths withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;
</pre></td></tr></table></figure>

<p><a href="http://www.cnblogs.com/smileEvday/archive/2012/06/28/tableView.html">这里有实例代码可以参考</a></p>
<p><a href="http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/TableView_iPhone/ManageInsertDeleteRow/ManageInsertDeleteRow.html#//apple_ref/doc/uid/TP40007451-CH10-SW1">官方教程</a></p>
<p>里面写了如何优化UITableView：</p>
<p><a href="http://www.keakon.net/2011/08/03/优化UITableView性能">又找了一篇blog写的很不错的样子，优化UITableView性能</a></p>
<h2>后记</h2>
<p>总结就是UITableView是一个高度设计的控件。它具有重用，分组，异步加载数据等方面需要我们注意。</p>
<p>其实这里插进来写UITableView是为了写NSFetchedResultsController。因为NSFetchedResultsController就是为UITableview量身打造的Core Data的类。 </p>
<p>所以，先说明以下UITableView，然后再写NSFetchedResultsController。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/iOS/">iOS</a>
  </div>

        
  
  <div class="tags">
    
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</div></div>
    <aside id="sidebar" class="alignright">
<div class="search">
  <form action="http://google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:iiiyu.com">
  </form>
</div>


<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/just-talk/">just-talk</a><small>12</small></li>
  
    <li><a href="/categories/Emacs/">Emacs</a><small>3</small></li>
  
    <li><a href="/categories/read-book-notes/">read-book-notes</a><small>2</small></li>
  
    <li><a href="/categories/iOS/">iOS</a><small>26</small></li>
  
    <li><a href="/categories/Mac/">Mac</a><small>1</small></li>
  
    <li><a href="/categories/Software/">Software</a><small>2</small></li>
  
  </ul>
</div>





<div class="widget twitter">
  <h3 class="title">推文</h3>
  <ul id="tweets"></ul>
</div>

<script type="text/javascript">
var twitter_stream = ['iyunsn', 5, true];
</script>
<script src="/js/twitter.js"></script>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 萧宸宇
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'iiiyu';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>